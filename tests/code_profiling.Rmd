--
output: html_document
--

```{r}
# currently on CRAN
detach("package:did")
library(did, lib.loc="~/R/old-versions")
packageVersion("did")
library(profvis)
# functions for simulating data
source("~/Dropbox/did/R/simulate_data.R")


n <- 5000
time.periods <- 8
sp <- reset.sim(n=n, time.periods=time.periods)

data <- build_sim_dataset(sp)
N <- nrow(data)
# add some more spurrious columns to data:
data$X1 <- sample(1:25, size=N, replace=TRUE)
#data$X1 <- as.factor(data$X1)
data$X2 <- rnorm(N)
data$X3 <- rnorm(N)
data$X4 <- rnorm(N)
data$X5 <- rnorm(N)

pt <- proc.time()

profvis({
cran_dr <- att_gt(yname="Y", xformla=~X, data=data, tname="period", idname="id",
                  gname="G", est_method="dr", allow_unbalanced_panel=TRUE)
})  

cran_time <- proc.time() - pt
cran_time


# now, try new code
devtools::load_all("~/Dropbox/BMisc")
devtools::load_all("~/Dropbox/did")

pt <- proc.time()

profvis({
new_dr <- att_gt(yname="Y", xformla=~X, data=data, tname="period", idname="id",
                 gname="G", est_method="dr", allow_unbalanced_panel=TRUE)
})

new_time <- proc.time() - pt
new_time

all(new_dr$att == cran_dr$att)

```
