<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Treatment Effects with Multiple Periods and Groups • did</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Treatment Effects with Multiple Periods and Groups">
<meta property="og:description" content="The standard Difference-in-Differences (DID) setup involves two periods and two groups -- a treated group and untreated group.  Many applications of DID methods involve more than two periods and have individuals that are treated at different points in time.  This package contains tools for computing average treatment effect parameters in Difference in Differences models with more than two periods and with variation in treatment timing using the methods developed in Callaway and Sant'Anna (2019) &lt;https://ssrn.com/abstract=3148250&gt;.  The main parameters are group-time average treatment effects which are the average treatment effect for a particular group at a a particular time.  These can be aggregated into a fewer number of treatment effect parameters, and the package deals with the cases where there is selective treatment timing, dynamic treatment effects, calendar time effects, or combinations of these.  There are also functions for testing the Difference in Differences assumption, and plotting group-time average treatment effects.">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">did</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/index.html">User Guides</a>
</li>
<li>
  <a href="reference/index.html">Functions</a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<p><img src="reference/figures/logo.png" width="150"></p>
<!-- badges: start -->






<!-- badges: end -->
<!-- README.md is generated from README.Rmd. Please edit that file -->
<p>The <strong>did</strong> package contains tools for computing average treatment effect parameters in a Difference in Differences setup allowing for</p>
<ul>
<li><p>More than two time periods</p></li>
<li><p>Variation in treatment timing (i.e., units can become treated at different points in time)</p></li>
<li><p>Treatment effect heterogeneity (i.e, the effect of participating in the treatment can vary across units and exhibit potentially complex dynamics, selection into treatment, or time effects)</p></li>
<li><p>The parallel trends assumption holds only after conditioning on covariates</p></li>
</ul>
<p>The main parameters are <strong>group-time average treatment effects</strong>. These are the average treatment effect for a particular group (group is defined by treatment timing) in a particular time period. These parameters are a natural generalization of the average treatment effect on the treated (ATT) which is identified in the textbook case with two periods and two groups to the case with multiple periods.</p>
<p>Group-time average treatment effects are also natural building blocks for more aggregated treatment effect parameters such as overall treatment effects or event study plots.</p>
<p>The <strong>did</strong> package also contains a number of functions for pre-testing the parallel trends assumption.</p>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting Started</h2>
<p>There has been a lot of recent work on DID with multiple time periods. The <strong>did</strong> package implements the ideas in</p>
<ul>
<li>Callaway, Brantly, and Pedro HC SantâAnna. Difference-in-differences with multiple time periods. Available at SSRN 3148250 (2019).</li>
</ul>
<p><strong>Other methodological papers on DID with multiple time periods include</strong></p>
<ul>
<li><p>Goodman-Bacon, Andrew. Difference-in-differences with variation in treatment timing. No. w25018. National Bureau of Economic Research, 2018.</p></li>
<li><p>de Chaisemartin, ClÃ©ment, and Xavier dâHaultfoeuille. Two-way fixed effects estimators with heterogeneous treatment effects. No. w25904. National Bureau of Economic Research, 2019.</p></li>
<li><p>Abraham, Sarah, and Liyang Sun. Estimating dynamic treatment effects in event studies with heterogeneous treatment effects. Available at SSRN 3158747 (2018).</p></li>
</ul>
<p><strong>Higher level discussions of issues are available in</strong></p>
<ul>
<li><p><a href="articles/multi-period-did.html">Our approach to DID with multiple time periods</a></p></li>
<li><p><a href="https://andrewcbaker.netlify.com/2019/09/25/difference-in-differences-methodology/">Baker, Andrew. Difference-in-Differences Methodology. (2019)</a></p></li>
</ul>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>You can install <strong>did</strong> from CRAN with:</p>
<div class="sourceCode"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span>(<span class="st">"did"</span>)</pre></div>
<p>or get the latest version from github with:</p>
<div class="sourceCode"><pre class="r"><span class="co"># install.packages("devtools")</span>
<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"bcallaway11/did"</span>)</pre></div>
</div>
<div id="a-short-example" class="section level2">
<h2 class="hasAnchor">
<a href="#a-short-example" class="anchor"></a>A short example</h2>
<p>The following is a simplified example of the effect of states increasing their minimum wages on county-level teen employment rates which comes from Callaway and SantâAnna (2019).</p>
<ul>
<li><a href="articles/did-basics">More detailed examples are also available</a></li>
</ul>
<p>A subset of the data is available in the package and can be loaded by</p>
<div class="sourceCode"><pre class="r">  <span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">did</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'did'</span>
<span class="co">#&gt; The following objects are masked _by_ '.GlobalEnv':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     compute.aggte, ggdid, gplot, indicator, MP, mp.spatt,</span>
<span class="co">#&gt;     mp.spatt.test, MP.TEST</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">mpdta</span>)</pre></div>
<p>The dataset contains 500 observations of county-level teen employment rates from 2003-2007. Some states are first treated in 2004, some in 2006, and some in 2007 (see the paper for more details). The important variables in the dataset are</p>
<ul>
<li><p><strong>lemp</strong> This is the log of county-level teen employment. It is the outcome variable</p></li>
<li><p><strong>first.treat</strong> This is the period when a state first increases its minimum wage. It can be 2004, 2006, or 2007. It is the variable that defines <em>group</em> in this application</p></li>
<li><p><strong>year</strong> This is the year and is the <em>time</em> variable</p></li>
<li><p><strong>countyreal</strong> This is an id number for each county and provides the individual identifier in this panel data context</p></li>
</ul>
<p>To estimate group-time average treatment effects, use the <strong>att_gt</strong> function</p>
<div class="sourceCode"><pre class="r"><span class="no">out</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/att_gt.html">att_gt</a></span>(<span class="kw">yname</span><span class="kw">=</span><span class="st">"lemp"</span>,
              <span class="kw">first.treat.name</span><span class="kw">=</span><span class="st">"first.treat"</span>,
              <span class="kw">idname</span><span class="kw">=</span><span class="st">"countyreal"</span>,
              <span class="kw">tname</span><span class="kw">=</span><span class="st">"year"</span>,
              <span class="kw">xformla</span><span class="kw">=</span>~<span class="fl">1</span>,
              <span class="kw">data</span><span class="kw">=</span><span class="no">mpdta</span>,
              <span class="kw">estMethod</span><span class="kw">=</span><span class="st">"reg"</span>,
              <span class="kw">printdetails</span><span class="kw">=</span><span class="fl">FALSE</span>,
              )</pre></div>
<p><strong>att_gt</strong> returns a class <strong>MP</strong> object. This has a lot of information, but most importantly is has estimates of the group-time average treatment effects and their standard errors. To see these, we can call the <strong>summary</strong> function</p>
<div class="sourceCode"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">out</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Reference: Callaway, Brantly and Sant'Anna, Pedro.  "Difference-in-Differences with Multiple Time Periods." Working Paper &lt;https://ssrn.com/abstract=3148250&gt;, 2019. </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  group   time          att          se</span>
<span class="co">#&gt; ------  -----  -----------  ----------</span>
<span class="co">#&gt;   2004   2004   -0.0105032   0.0232510</span>
<span class="co">#&gt;   2004   2005   -0.0704232   0.0309848</span>
<span class="co">#&gt;   2004   2006   -0.1372587   0.0364357</span>
<span class="co">#&gt;   2004   2007   -0.1008114   0.0343592</span>
<span class="co">#&gt;   2006   2004    0.0065201   0.0233268</span>
<span class="co">#&gt;   2006   2005   -0.0027508   0.0195586</span>
<span class="co">#&gt;   2006   2006   -0.0045946   0.0177552</span>
<span class="co">#&gt;   2006   2007   -0.0412245   0.0202292</span>
<span class="co">#&gt;   2007   2004    0.0305067   0.0150336</span>
<span class="co">#&gt;   2007   2005   -0.0027259   0.0163958</span>
<span class="co">#&gt;   2007   2006   -0.0310871   0.0178775</span>
<span class="co">#&gt;   2007   2007   -0.0260544   0.0166554</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; P-value for pre-test of DID assumption:  0.16812</span></pre></div>
<p>This provides estimates of group-time average treatment effects for all groups in all time periods. Group-time average treatment effects are identified when <code>g &lt;= t</code> (these are post-treatment time periods for each group), but <strong>summary</strong> reports them even in periods when <code>g &gt; t</code> â these can be used a pre-test for the parallel trends assumption. The <code>p-value for pre-test of DID assumption</code> is for a Wald pre-test of the parallel trends assumption. Here the parallel trends assumption would not be rejected at conventional significance levels.</p>
<p>It is often also convenient to plot the group-time average treatment effects. This can be done using the <strong>ggdid</strong> command:</p>
<div class="sourceCode"><pre class="r"><span class="fu"><a href="reference/ggdid.html">ggdid</a></span>(<span class="no">out</span>, <span class="kw">ylim</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">.25</span>,<span class="fl">.1</span>))</pre></div>
<p><img src="reference/figures/README-unnamed-chunk-8-1.png"></p>
<p>The red dots in the plot are pre-treatment group-time average treatment effects . Here they are provided with 95% pointwise confidence intervals. These are the estimates that can be interpreted as a pre-test (up to some caveats about multiple hypothesis testing). The blue dots are post-treatment group-time average treatment effects. Under the parallel trends assumption, these can be interpreted as policy effects â here the effect of the minimum wage on county-level teen employment due to increasing the minimum wage.</p>
<p><strong>Event Studies</strong></p>
<p>Although in the current example it is pretty easy to directly interpret the group-time average treatment effects, there are many cases where it is convenient to aggregate the group-time average treatment effects into a small number of parameters. A main type of aggregation is into an <em>event study</em> plot.</p>
<p>To make an event study plot in the <strong>did</strong> package, one can use the <strong>aggte</strong> function</p>
<div class="sourceCode"><pre class="r"><span class="no">es</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/aggte.html">aggte</a></span>(<span class="no">out</span>, <span class="kw">type</span><span class="kw">=</span><span class="st">"dynamic"</span>)</pre></div>
<p>Just like for group-time average treatment effects, these can be summarized and plotted. And then one can summarize these</p>
<div class="sourceCode"><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(<span class="no">es</span>)
<span class="co">#&gt; </span>
<span class="co">#&gt; Reference: Callaway, Brantly and Sant'Anna, Pedro.  "Difference-in-Differences with Multiple Time Periods." Working Paper &lt;https://ssrn.com/abstract=3148250&gt;, 2019. </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Overall ATT:  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;         att         se</span>
<span class="co">#&gt; -----------  ---------</span>
<span class="co">#&gt;  -0.0772398   0.019965</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Dynamic Effects:</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  event time          att          se</span>
<span class="co">#&gt; -----------  -----------  ----------</span>
<span class="co">#&gt;          -3    0.0305067   0.0150336</span>
<span class="co">#&gt;          -2   -0.0005631   0.0132916</span>
<span class="co">#&gt;          -1   -0.0244587   0.0142364</span>
<span class="co">#&gt;           0   -0.0199318   0.0118264</span>
<span class="co">#&gt;           1   -0.0509574   0.0168935</span>
<span class="co">#&gt;           2   -0.1372587   0.0364357</span>
<span class="co">#&gt;           3   -0.1008114   0.0343592</span></pre></div>
<p>The column <code>event time</code> is for each group relative to when they first participate in the treatment. To give some examples, <code>event time=0</code> corresponds to the <em>on impact</em> effect, and <code>event time=-1</code> is the <em>effect</em> in the period before a unit becomes treated (checking that this is equal to 0 is potentially useful as a pre-test).</p>
<p>To plot the event study, use <strong>ggdid</strong></p>
<div class="sourceCode"><pre class="r"><span class="fu"><a href="reference/ggdid.html">ggdid</a></span>(<span class="no">es</span>)</pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png"></p>
<p>The figure here is very similar to the group-time average treatment effects. Red dots are pre-treatment periods, blue dots are post-treatment periods. The difference is that the x-axis is in event time.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=did">https://​cloud.r-project.org/​package=did</a>
</li>
<li>Source Code at <br><a href="https://github.com/bcallaway11/did">https://​github.com/​bcallaway11/​did</a>
</li>
<li>Report Bugs or Feature Requests at <br><a href="https://github.com/bcallaway11/did/issues">https://​github.com/​bcallaway11/​did/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-2">GPL-2</a></li>
</ul>
</div>
<div class="citation">
<h2>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html">Citing did</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Brantly Callaway <br><small class="roles"> Author, maintainer </small>  </li>
<li>Pedro H.C. Sant'Anna <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=did"><img src="http://cranlogs.r-pkg.org/badges/grand-total/did?color=orange"></a></li>
<li><a href="https://cran.r-project.org/package=did"><img src="http://cranlogs.r-pkg.org/badges/last-month/did?color=green"></a></li>
<li><a href="https://cran.r-project.org/package=did"><img src="https://www.r-pkg.org/badges/version/did?color=blue"></a></li>
<li><a href="https://github.com/bcallaway11/did"><img src="https://img.shields.io/badge/devel%20version-1.3.0-blue.svg"></a></li>
<li><a href="https://github.com/bcallaway11/did"><img src="https://img.shields.io/github/languages/code-size/bcallaway11/did.svg"></a></li>
<li><a href="https://cran.r-project.org/web/checks/check_results_did.html"><img src="https://cranchecks.info/badges/summary/did" alt="CRAN checks"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by Brantly Callaway, Pedro H.C. Sant'Anna.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
