<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DID with Multiple Time Periods • did</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="DID with Multiple Time Periods">
<meta property="og:description" content="did">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">did</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/did-basics.html">Introduction to the did Package</a>
    </li>
    <li>
      <a href="../articles/multi-period-did.html">DID with Multiple Time Periods</a>
    </li>
    <li>
      <a href="../articles/pre-testing.html">Pre-Testing</a>
    </li>
    <li>
      <a href="../articles/tests.html">Introduction to the did Package</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>DID with Multiple Time Periods</h1>
                        <h4 class="author">Brantly Callaway and Pedro H.C. Sant'Anna</h4>
            
            <h4 class="date">2020-03-30</h4>
      
      
      <div class="hidden name"><code>multi-period-did.Rmd</code></div>

    </div>

    
    
<div id="did-with-multiple-time-periods" class="section level1">
<h1 class="hasAnchor">
<a href="#did-with-multiple-time-periods" class="anchor"></a>DID with Multiple Time Periods</h1>
<p>Difference in differences is one of the most common approaches for trying to identifying and estimate the causal effect of participating in a treatment on some outcome.</p>
<p>The “textbook” version of DID involves two periods and two groups. The <em>untreated group</em> never participates in the treatment, and the <em>treated group</em> becomes treated in the second period.</p>
<p>However, much applied work deals with cases where there are more than two time periods and different individuals can become treated at different points in time. Regardless of the number of time periods, by far the leading approach in applied work is to try to estimate the effect of the treatment using a two way fixed effects regression. This works great in the case with two periods, but there are a number of recent methodological papers that suggest that there may be substantial drawbacks to using two way fixed effects with multiple time periods.</p>
<p>This vignette briefly discusses the emerging literature on DID with multiple time periods – both issues with standard approaches as well as remedies for these potential problems. The <code>did</code> package implements a number of these remedies. A vignette for how to use the <code>did</code> package is available <a href="did-basics.html">here</a>.</p>
<div id="background" class="section level2">
<h2 class="hasAnchor">
<a href="#background" class="anchor"></a>Background</h2>
<p>This section covers two . First, it discusses DID with two time periods and two groups – this is the “textbook” case of DID. Second, it briefly considers issues with two way fixed effects regressions when there are multiple time periods.</p>
<div id="did-with-2-periods-and-2-groups" class="section level3">
<h3 class="hasAnchor">
<a href="#did-with-2-periods-and-2-groups" class="anchor"></a>DID with 2 Periods and 2 Groups</h3>
<p>The baseline case for DID is the one with two periods (let’s call these periods <span class="math inline">\(t\)</span> and <span class="math inline">\(t-1\)</span>) and two groups (a treated group and an untreated group).</p>
<p><strong>Notation / Setup</strong></p>
<ul>
<li><p>For <span class="math inline">\(s \in \{t,t-1\}\)</span>, <span class="math inline">\(Y_{is}(0)\)</span> is individual <span class="math inline">\(i\)</span>’s <em>untreated potential outcomes</em> – this is the outcome that individual <span class="math inline">\(i\)</span> would experience in period <span class="math inline">\(s\)</span> if they <em>did not</em> participate in the treatment</p></li>
<li><p>For <span class="math inline">\(s \in \{t,t-1\}\)</span>, <span class="math inline">\(Y_{is}(1)\)</span> is individual <span class="math inline">\(i\)</span>’s <em>treated potential outcome</em> – this is the outcome that individual <span class="math inline">\(i\)</span> would experience in period <span class="math inline">\(s\)</span> if they <em>did</em> participate in the treatment.</p></li>
<li><p>Set <span class="math inline">\(D=1\)</span> for individuals in the treated group and <span class="math inline">\(D=0\)</span> for individuals in the untreated group</p></li>
<li><p>In the first period, no one participates in the treatment. In the second period, individuals in the treated group become treated. This means that observed outcomes are given by <span class="math display">\[
  Y_{it-1} = Y_{it-1}(0) \quad \textrm{and} \quad Y_{it} = D_i Y_{it}(1) + (1-D_i) Y_{it}(0)
\]</span> In other words, in the first period, we observe untreated potential outcomes for everyone. In the second period, we observe treated potential outcomes for individuals that actually participate in the treatment and untreated potential outcomes for individuals that do not participate in the treatment.</p></li>
<li><p>The main parameter of interest in most DID designs is the Average Treatment Effect on the Treated (ATT). It is given by <span class="math display">\[
  ATT = E[Y_t(1) - Y_t(0) | D=1]
\]</span> This is the difference between treated and untreated potential outcomes, on average, for individuals in the treated group.</p></li>
</ul>
<p>The main assumption in DID designs is called the parallel trends assumption:</p>
<p><strong>Parallel Trends Assumption</strong></p>
<p><span class="math display">\[
  E[\Delta Y_t(0) | D=1] = E[\Delta Y_t(0) | D=0]
\]</span></p>
<p>In words, this assumption says that the change (or “path”) in outcomes over time experienced that individuals in the treated group <em>would have experienced if they had not participated in the treatment</em> is the same as the path of outcomes that individuals in the untreated group actually experienced. The parallel trends assumption allows for the level of untreated potential outcomes to differ across groups and is consistent with, for example, fixed effects models for untreated potential outcomes where the mean of the unobserved fixed effect can be different across groups.</p>
<p>This assumption is potentially useful because the path of untreated potential outcomes for individuals in the treated group (the term on the left in the above equation) is not known, but the the researcher does observe the path of untreated potential outcomes for individuals in the untreated group. In fact, it is straightforward to show that, under the parallel trends assumption, the <span class="math inline">\(ATT\)</span> is identified and given by <span class="math display">\[
  ATT = E[\Delta Y_t | D=1] - E[\Delta Y_t | D=0]
\]</span></p>
<p>That is, the <span class="math inline">\(ATT\)</span> is the difference between the mean change in outcomes over time experienced by individuals in the treated group adjusted by the mean change in outcomes over time experienced by individuals in the untreated group; the latter term, under the parallel trends assumption, is what the path of outcomes for individuals in the treated group would have been if they had not participated in the treatment.</p>
</div>
<div id="two-way-fixed-effects-regressions" class="section level3">
<h3 class="hasAnchor">
<a href="#two-way-fixed-effects-regressions" class="anchor"></a>Two way fixed effects regressions</h3>
<p>By far the most common approach to <em>trying</em> to estimate the effect of a binary treatment in this setup is the two way fixed effects regression (TWFE). This is a regression like <span class="math display">\[
Y_{it} = \theta_t + \eta_i + \alpha D_{it} + v_{it}
\]</span> where <span class="math inline">\(\theta_t\)</span> is a time fixed effect, <span class="math inline">\(\eta_i\)</span> is an individual fixed effect, <span class="math inline">\(D_{it}\)</span> is a treatment dummy variable, <span class="math inline">\(v_{it}\)</span> are time varying unobservables that are mean independent of everything else, and <span class="math inline">\(\alpha\)</span> is the parameter of interest. <span class="math inline">\(\alpha\)</span> is often interpreted as <em>the effect</em> or the <em>average effect</em> of participating in the treatment.</p>
<p>Although this is essentially a standard approach in applied work, there are a number of recent papers that point out potentially severe drawbacks of using the TWFE estimation procedure. Academic papers: Goodman-Bacon (2019) and de Chaisemartin and D’Haultfoeuille (2019); More accessible discussion: <a href="https://andrewcbaker.netlify.com/2019/09/25/difference-in-differences-methodology/">Baker (2019)</a></p>
<p><strong>When will TWFE work?</strong></p>
<ol style="list-style-type: decimal">
<li><p>Effects really aren’t heterogeneous. If the effect of participating in the treatment really is <span class="math inline">\(\alpha\)</span> for all individuals, TWFE will work great. Actually, you can allow for some limited forms of treatment effect heterogeneity; if the average effect of participating in the treatment is the same for all groups (defined by treatment timing) across all time periods, TWFE will work just fine.</p></li>
<li><p>There are only two time periods. This is the textbook case (2 periods, one group becomes treated in the second period, the other is never treated). In this case, under parallel trends, <span class="math inline">\(\alpha\)</span> is going to be numerically equal to the <span class="math inline">\(ATT\)</span>. In other words, in this case, even though it looks like you have restricted the effect of participating in the treatment to be the same across all individuals, TWFE exhibits <em>robustness</em> to treatment effect heterogeneity. Unfortunately, this robustness to treatment effect heterogeneity does not continue to hold when ther are more periods and groups become treated at different points in time.</p></li>
</ol>
<p><strong>Why is TWFE not robust to treatment effect heterogeneity?</strong></p>
<p>There are entire papers written about this. But here is the short version: in a TWFE regression, units whose treatment status doesn’t change over time serve as the controls for units whose treatment status does change over time. With multiple time periods and variation of treatment timing, some of these comparisons are:</p>
<ul>
<li><p>newly treated units relative to never treated units (good!)</p></li>
<li><p>newly treated units relative to not yet treated units (good!)</p></li>
<li><p>newly treated units relative to already treated units (bad!!!)</p></li>
</ul>
<p>The first of these two comparisons are good (or at least in the spirit of DID) in that they take the path of outcomes experienced by units that become treated and adjust it by the path of outcomes that experienced by units that are not participating in the treatment. The third comparison is different though: it adjusts the path of outcomes for newly treated units by the path of outcomes for already treated units. But this is not the path of untreated potential outcomes, it includes <em>treatment effect dynamics</em>. Thus, these dynamics appear in <span class="math inline">\(\alpha\)</span> <em>as part of the control</em>.</p>
<p>And this issue can have potentially severe consequences. For example, it is possible to come up with examples where the effect of participating in the treatment is positive for all individuals in all time periods, but the TWFE estimation procedure leads to estimating a negative effect of participating in the treatment.</p>
<p><a href="https://andrewcbaker.netlify.com/2019/09/25/difference-in-differences-methodology/">Baker (2019)</a> has a really nice (and accessible) discussion of these issues in more detail.</p>
<p><strong>Notation</strong></p>
<ul>
<li><p><span class="math inline">\(Y_{it}(0)\)</span> is individual <span class="math inline">\(i\)</span>’s untreated potential outcome. This is the outcome that individual <span class="math inline">\(i\)</span> would experience in period <span class="math inline">\(t\)</span> if they do not participate in the treatment.</p></li>
<li><p><span class="math inline">\(Y_{it}(g)\)</span> is individual <span class="math inline">\(i\)</span>’s potential outcome in time period <span class="math inline">\(t\)</span> if they become treated in period <span class="math inline">\(g\)</span>.</p></li>
<li><p><span class="math inline">\(G_i\)</span> is the time period when individual <span class="math inline">\(i\)</span> becomes treated (often <em>groups</em> are defined by the time period when a unit becomes treated; hence, the <span class="math inline">\(G\)</span> notation). Set <span class="math inline">\(G_i = 0\)</span> for individuals that are never treated.</p></li>
<li><p><span class="math inline">\(Y_{it}\)</span> is individual <span class="math inline">\(i\)</span>’s observed outcome in time period <span class="math inline">\(t\)</span>. It is given by <span class="math inline">\(Y_{it} = \indicator{G_i = 0} Y_{it}(0) + \indicator{G_i = g} \indicator{G_i \leq t} Y_{it}(g)\)</span>. The notation here is a bit complicated, but in words, the observed outcome in period <span class="math inline">\(t\)</span> is an untreated potential outcome for individuals that are never treated and for individuals that are not treated yet in period <span class="math inline">\(t\)</span>. Otherwise (i.e., in time periods where individual <span class="math inline">\(i\)</span> is already treated), we observe their treated potential outcome (which can depend on <em>when</em> they became treated)</p></li>
<li><p><span class="math inline">\(X_i\)</span> vector of covariates</p></li>
</ul>
<p>The main identifying assumption in DID designs is the parallel trends assumption.</p>
</div>
</div>
<div id="group-time-average-treatment-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#group-time-average-treatment-effects" class="anchor"></a>Group-Time Average Treatment Effects</h2>
<p>A natural way to generalize the two period - two group case is to define <em>group-time average treatment effects</em>:</p>
<p><span class="math display">\[
  ATT(g,t) = E[Y_t(g) - Y_t(0) | G=g]
\]</span></p>
<p>This is the average effect of participating in the treatment for individuals in group <span class="math inline">\(g\)</span> at time period <span class="math inline">\(t\)</span>. Notice that when there are two time periods and two groups (the textbook case), the average treatment effect on the treated is given by <span class="math inline">\(ATT = ATT(g=2,t=2)\)</span>.</p>
<p>To give a couple more examples, suppose that a researcher has access to three time periods. Then, <span class="math inline">\(ATT(g=2,t=3)\)</span> is the average effect of participating in the treatment for the group of individuals that become treated in time period 2 in time period 3. Similarly, <span class="math inline">\(ATT(g=3,t=3)\)</span> is the average effect of participating in the treatment for the group of individuals that become treated in time period 3 in time period 3.</p>
<p>It is also possible to extend the parallel trends assumption to the case with more than two time periods.</p>
</div>
<div id="event-studies" class="section level2">
<h2 class="hasAnchor">
<a href="#event-studies" class="anchor"></a>Event Studies</h2>
<div id="common-pitfalls" class="section level3">
<h3 class="hasAnchor">
<a href="#common-pitfalls" class="anchor"></a>Common Pitfalls</h3>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brantly Callaway, Pedro H.C. Sant'Anna.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
