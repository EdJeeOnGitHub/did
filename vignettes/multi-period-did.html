<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Brantly Callaway and Pedro H.C. Sant'Anna" />

<meta name="date" content="2020-11-06" />

<title>Introduction to DID with Multiple Time Periods</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      </style>





<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />




</head>

<body>




<h1 class="title toc-ignore">Introduction to DID with Multiple Time Periods</h1>
<h4 class="author">Brantly Callaway and Pedro H.C. Sant'Anna</h4>
<h4 class="date">2020-11-06</h4>



<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Difference in differences is one of the most common approaches for trying to identifying and estimate the causal effect of participating in a treatment on some outcome.</p>
<p>The &quot;textbook&quot; version of DID involves two periods and two groups. The <em>untreated group</em> never participates in the treatment, and the <em>treated group</em> becomes treated in the second period.</p>
<p>However, much applied work deals with cases where there are more than two time periods and different individuals can become treated at different points in time. Regardless of the number of time periods, by far the leading approach in applied work is to try to estimate the effect of the treatment using a two way fixed effects regression. This works great in the case with two periods, but there are a number of recent methodological papers that suggest that there may be substantial drawbacks to using two way fixed effects with multiple time periods.</p>
<p>This vignette briefly discusses the emerging literature on DID with multiple time periods -- both issues with standard approaches as well as remedies for these potential problems. The <code>did</code> package implements a number of these remedies. A vignette for how to use the <code>did</code> package is available <a href="did-basics.html">here</a>.</p>
</div>
<div id="background" class="section level2">
<h2>Background</h2>
<p>To start with, we'll consider some background material in this section. First, we'll discuss DID with two time periods and two groups -- this is the &quot;textbook&quot; case of DID. Second, we briefly consider issues with two way fixed effects regressions when there are multiple time periods.</p>
<div id="did-with-2-periods-and-2-groups" class="section level3">
<h3>DID with 2 Periods and 2 Groups</h3>
<p>The baseline case for DID is the one with two periods (let's call these periods <span class="math inline">\(t\)</span> and <span class="math inline">\(t-1\)</span>) and two groups (a treated group and an untreated group).</p>
<p><strong>Notation / Setup</strong></p>
<ul>
<li><p>For <span class="math inline">\(s \in \{t,t-1\}\)</span>, <span class="math inline">\(Y_{is}(0)\)</span> is individual <span class="math inline">\(i\)</span>'s <em>untreated potential outcomes</em> -- this is the outcome that individual <span class="math inline">\(i\)</span> would experience in period <span class="math inline">\(s\)</span> if they <em>did not</em> participate in the treatment</p></li>
<li><p>For <span class="math inline">\(s \in \{t,t-1\}\)</span>, <span class="math inline">\(Y_{is}(1)\)</span> is individual <span class="math inline">\(i\)</span>'s <em>treated potential outcome</em> -- this is the outcome that individual <span class="math inline">\(i\)</span> would experience in period <span class="math inline">\(s\)</span> if they <em>did</em> participate in the treatment.</p></li>
<li><p>Set <span class="math inline">\(D=1\)</span> for individuals in the treated group and <span class="math inline">\(D=0\)</span> for individuals in the untreated group</p></li>
<li><p>In the first period, no one participates in the treatment. In the second period, individuals in the treated group become treated. This means that observed outcomes are given by <span class="math display">\[
  Y_{it-1} = Y_{it-1}(0) \quad \textrm{and} \quad Y_{it} = D_i Y_{it}(1) + (1-D_i) Y_{it}(0)
\]</span> In other words, in the first period, we observe untreated potential outcomes for everyone. In the second period, we observe treated potential outcomes for individuals that actually participate in the treatment and untreated potential outcomes for individuals that do not participate in the treatment.</p></li>
<li><p>The main parameter of interest in most DID designs is the Average Treatment Effect on the Treated (ATT). It is given by <span class="math display">\[
  ATT = E[Y_t(1) - Y_t(0) | D=1]
\]</span> This is the difference between treated and untreated potential outcomes, on average, for individuals in the treated group.</p></li>
</ul>
<p>The main assumption in DID designs is called the parallel trends assumption:</p>
<p><strong>Parallel Trends Assumption</strong></p>
<p><span class="math display">\[
  E[\Delta Y_t(0) | D=1] = E[\Delta Y_t(0) | D=0]
\]</span></p>
<p>In words, this assumption says that the change (or &quot;path&quot;) in outcomes over time that individuals in the treated group <em>would have experienced if they had not participated in the treatment</em> is the same as the path of outcomes that individuals in the untreated group actually experienced. The parallel trends assumption allows for the level of untreated potential outcomes to differ across groups and is consistent with, for example, fixed effects models for untreated potential outcomes where the mean of the unobserved fixed effect can be different across groups.</p>
<p>This assumption is potentially useful because the path of untreated potential outcomes for individuals in the treated group (the term on the left in the above equation) is not known, but the researcher does observe the path of untreated potential outcomes for individuals in the untreated group. In fact, it is straightforward to show that, under the parallel trends assumption, the <span class="math inline">\(ATT\)</span> is identified and given by <span class="math display">\[
  ATT = E[\Delta Y_t | D=1] - E[\Delta Y_t | D=0]
\]</span></p>
<p>That is, the <span class="math inline">\(ATT\)</span> is the difference between the mean change in outcomes over time experienced by individuals in the treated group adjusted by the mean change in outcomes over time experienced by individuals in the untreated group; the latter term, under the parallel trends assumption, is what the path of outcomes for individuals in the treated group would have been if they had not participated in the treatment.</p>
</div>
<div id="two-way-fixed-effects-regressions" class="section level3">
<h3>Two way fixed effects regressions</h3>
<p>Now let's move to a more general case where there are <span class="math inline">\(\mathcal{T}\)</span> total time periods. Denote particular time periods by <span class="math inline">\(t\)</span> where <span class="math inline">\(t=1,\ldots,\mathcal{T}\)</span>.</p>
<p>By far the most common approach to <em>trying</em> to estimate the effect of a binary treatment in this setup is the two way fixed effects regression (TWFE). This is a regression like <span class="math display">\[
Y_{it} = \theta_t + \eta_i + \alpha D_{it} + v_{it}
\]</span> where <span class="math inline">\(\theta_t\)</span> is a time fixed effect, <span class="math inline">\(\eta_i\)</span> is an individual fixed effect, <span class="math inline">\(D_{it}\)</span> is a treatment dummy variable, <span class="math inline">\(v_{it}\)</span> are time varying unobservables that are mean independent of everything else, and <span class="math inline">\(\alpha\)</span> is the parameter of interest. <span class="math inline">\(\alpha\)</span> is often interpreted as <em>the effect</em> or the <em>average effect</em> of participating in the treatment.</p>
<p>Although this is essentially a standard approach in applied work, there are a number of recent papers that point out potentially severe drawbacks of using the TWFE estimation procedure. These include: Goodman-Bacon (2019) and de Chaisemartin and D'Haultfoeuille (2020).</p>
<p><strong>When will TWFE work?</strong></p>
<ol style="list-style-type: decimal">
<li><p>Effects really aren't heterogeneous. If the effect of participating in the treatment really is <span class="math inline">\(\alpha\)</span> for all units, TWFE will work great. That being said, in many applications, treatment effects are very likely to be heterogeneous -- they can may vary across different units or exhibit dynamics or change across different time periods. In particular applications, this is worth thinking about, but, at least in our view, we think that heterogeneous effects of participating in some treatment is the leading case. [Actually, there is one caveat here in that you can allow for some limited forms of treatment effect heterogeneity; if the average effect of participating in the treatment is the same for all groups (defined by treatment timing) across all time periods, TWFE will work just fine. This is still a subtle case, and one advantage of the newer approaches is that they are robust (i.e., will work just fine in either case).]</p></li>
<li><p>There are only two time periods. This is the textbook case (2 periods, one group becomes treated in the second period, the other is never treated). In this case, under parallel trends, <span class="math inline">\(\alpha\)</span> is going to be numerically equal to the <span class="math inline">\(ATT\)</span>. In other words, in this case, even though it looks like you have restricted the effect of participating in the treatment to be the same across all units, TWFE exhibits <em>robustness</em> to treatment effect heterogeneity. Unfortunately, this robustness to treatment effect heterogeneity does not continue to hold when ther are more periods and groups become treated at different points in time.</p></li>
</ol>
<p><strong>Why is TWFE not robust to treatment effect heterogeneity?</strong></p>
<p>There are entire papers written about this. But here is the short version: in a TWFE regression, units whose treatment status doesn't change over time serve as the controls for units whose treatment status does change over time. With multiple time periods and variation of treatment timing, some of these comparisons are:</p>
<ul>
<li><p>newly treated units relative to never treated units (good!)</p></li>
<li><p>newly treated units relative to not yet treated units (good!)</p></li>
<li><p>newly treated units relative to already treated units (bad!!!)</p></li>
</ul>
<p>The first of these two comparisons are good (or at least in the spirit of DID) in that they take the path of outcomes experienced by units that become treated and adjust it by the path of outcomes experienced by units that are not participating in the treatment. The third comparison is different though: it adjusts the path of outcomes for newly treated units by the path of outcomes for already treated units. But this is not the path of untreated potential outcomes, it includes <em>treatment effect dynamics</em>. Thus, these dynamics appear in <span class="math inline">\(\alpha\)</span> <em>as part of the control</em>.</p>
<p>And this issue can have potentially severe consequences. For example, it is possible to come up with examples where the effect of participating in the treatment is positive for all units in all time periods, but the TWFE estimation procedure leads to estimating a negative effect of participating in the treatment.</p>
</div>
</div>
<div id="treatment-effects-in-difference-in-differences-designs-with-multiple-periods" class="section level2">
<h2>Treatment Effects in Difference in Differences Designs with Multiple Periods</h2>
<p>In light of the potential problems with TWFE regressions in DID designs with multiple periods, are there alternative approaches that can be used in this case?</p>
<p>Yes, and it turns out that it is not all that complicated!</p>
<p>To fix ideas, let's provide some extended notation and be clear about the identifying assumptions that we are going to make.</p>
<p><strong>Notation</strong></p>
<ul>
<li><p><span class="math inline">\(Y_{it}(0)\)</span> is individual <span class="math inline">\(i\)</span>'s untreated potential outcome. This is the outcome that individual <span class="math inline">\(i\)</span> would experience in period <span class="math inline">\(t\)</span> if they do not participate in the treatment.</p></li>
<li><p><span class="math inline">\(Y_{it}(g)\)</span> is individual <span class="math inline">\(i\)</span>'s potential outcome in time period <span class="math inline">\(t\)</span> if they become treated in period <span class="math inline">\(g\)</span>.</p></li>
<li><p><span class="math inline">\(G_i\)</span> is the time period when individual <span class="math inline">\(i\)</span> becomes treated (often <em>groups</em> are defined by the time period when a unit becomes treated; hence, the <span class="math inline">\(G\)</span> notation).</p></li>
<li><p><span class="math inline">\(C_i\)</span> is an indicator variable for whether or not an individuals is in the untreated group (it is possible for the control group to change across different time periods, but, to keep things simple here, just consider the case where we use units that never participate in the treatment as the control group).</p></li>
<li><p><span class="math inline">\(Y_{it}\)</span> is individual <span class="math inline">\(i\)</span>'s observed outcome in time period <span class="math inline">\(t\)</span>. For individuals in the untreated group, <span class="math inline">\(Y_{it} = Y_{it}(0)\)</span> in all time periods. For individuals in other groups, we observe <span class="math inline">\(Y_{it} = \mathbf{1}\{ G_i &gt; t\} Y_{it}(0) + \mathbf{1}\{G_i \leq t \} Y_{it}(G_i)\)</span>. The notation here is a bit complicated, but in words, we observe untreated potential outcomes for units that have not yet participated in the treatment, and we observe treated potential outcomes for units once they start to participate in the treatment (and these can depend on <em>when</em> they became treated).</p></li>
<li><p><span class="math inline">\(X_i\)</span> vector of covariates</p></li>
</ul>
<div id="main-assumptions" class="section level3">
<h3>Main Assumptions</h3>
<p><strong>Parallel Trends Assumption</strong> For all <span class="math inline">\(g=2,...,\mathcal{T}\)</span>, <span class="math inline">\(t=2,...,\mathcal{T}\)</span> with <span class="math inline">\(g \leq t\)</span>, <span class="math display">\[
  E[\Delta Y_t(0) | G=g] = E[\Delta Y_t(0) | C=1]
\]</span></p>
<p>This is a natural extension of the parallel trends assumption in the two period and two group case. It says that, in the absence of treatment, trends in untreated potential outcomes would be the same across groups. It also assumes it only when <span class="math inline">\(g \leq t\)</span> -- these are post-treatment periods for units in group <span class="math inline">\(g\)</span>.</p>
<p><strong>Staggered Treatment Adoption Assumption</strong> Let <span class="math inline">\(D_{it} = 1\)</span> if an individual participates in the treatment and <span class="math inline">\(D_{it}=0\)</span> otherwise. Then, for <span class="math inline">\(t=1,...,\mathcal{T}-1\)</span>, <span class="math inline">\(D_{it} = 1 \implies D_{it+1} = 1\)</span>.</p>
<p>Staggered treatment adoption implies that once a unit participates in the treatment, they remain in the treatment. This is a leading case in many applications in economics. For example, it would be the case for policies that roll out to different locations over some period of time. It would also be the case for many individual-level treatments that have a &quot;scarring&quot; effect. For example, in the context of job training, most applications consider participating in the treatment <em>ever</em> as defining treatment, not participating in some job training program year after year. This assumption is what allows us to define groups by treatment timing.</p>
</div>
</div>
<div id="group-time-average-treatment-effects" class="section level2">
<h2>Group-Time Average Treatment Effects</h2>
<p>The above assumptions are natural extensions of the identifying assumptions in the two period and two group case to the multiple period case.</p>
<p>Likewise, a natural way to generalize the parameter of interest (the ATT) from the two period and two group case to the multiple period case is to define <strong>group-time average treatment effects</strong>:</p>
<p><span class="math display">\[
  ATT(g,t) = E[Y_t(g) - Y_t(0) | G=g]
\]</span></p>
<p>This is the average effect of participating in the treatment for individuals in group <span class="math inline">\(g\)</span> at time period <span class="math inline">\(t\)</span>. Notice that when there are two time periods and two groups (the textbook case), the average treatment effect on the treated is given by <span class="math inline">\(ATT = ATT(g=2,t=2)\)</span>.</p>
<p>To give a couple more examples, suppose that a researcher has access to three time periods. Then, <span class="math inline">\(ATT(g=2,t=3)\)</span> is the average effect of participating in the treatment for the group of individuals that become treated in time period 2 in time period 3. Similarly, <span class="math inline">\(ATT(g=3,t=3)\)</span> is the average effect of participating in the treatment for the group of individuals that become treated in time period 3 in time period 3.</p>
<p><strong>Identification of Group-Time Average Treatment Effects</strong></p>
<p>Under the parallel trends assumption, it is straightforward to show that group-time average treatment effects are identified.</p>
<p>These group-time average treatment effects are the building blocks of understanding the effect of participating in a treatment in DID designs with multiple time periods.</p>
</div>
<div id="parallel-trends-conditional-on-covariates" class="section level2">
<h2>Parallel Trends Conditional on Covariates</h2>
<p>In many cases, the parallel trends assumption is substantially more plausible if it holds after conditioning on observed covariates. In other words, if the parallel trends assumption is modified to be</p>
<p><strong>Parallel Trends Assumption</strong> For all <span class="math inline">\(g=2,...,\mathcal{T}\)</span>, <span class="math inline">\(t=2,...,\mathcal{T}\)</span> with <span class="math inline">\(g \leq t\)</span>, <span class="math display">\[
  E[\Delta Y_t(0) | X, G=g] = E[\Delta Y_t(0) | X, C=1]
\]</span></p>
<p>This assumption says that the path of outcomes that units in group <span class="math inline">\(g\)</span> would have experienced if they had not participated in the treatment is the same as the path of outcomes for units in the untreated group <em>conditional on having the same covariates</em>.</p>
<p>An example of a case where this assumption is attractive is one where a researcher is interested in estimating the effect of participating in job training on earnings. In that case, if the path of earnings (in the absence of participating in job training) depends on things like education, previous occupation, or years of experience (which it almost certainly does), then it would be important to condition on these types of variables in order to make parallel trends hold.</p>
<p>In this case, the parameter of interest is still often the <span class="math inline">\(ATT\)</span>. It is still straightforward to identify and estimate the <span class="math inline">\(ATT\)</span> in this case. Basically, one needs to estimate the change in outcomes for individuals in the untreated group conditional on <span class="math inline">\(X\)</span>, but average out <span class="math inline">\(X\)</span> over the distribution of covariates for indivduals in group <span class="math inline">\(g\)</span> to obtain <span class="math inline">\(ATT(g,t)\)</span> (see Callaway and Sant'Anna (2020) and references therein for many more details). But the <strong>did</strong> package automates all of this for the user in this case.</p>
</div>
<div id="aggregating-group-time-average-treatment-effects" class="section level2">
<h2>Aggregating Group-Time Average Treatment Effects</h2>
<p>Group-time average treatment effects are natural parameters to identify in the context of DID with multiple periods and multiple groups. But in many applications, there may be a lot of them. There are some benefits and costs here. The main benefit is that it is relatively straightforward to think about heterogeneous effects across groups and time using group-time average treatment effects. On the other hand, it can be hard to summarize them (e.g., they are not just a single number).</p>
<p>In our paper, we propose a number of ways to aggregate group-time average treatment effects. Here, we will just consider a few that we think applied researchers are most likely to use. First, consider the average effect of participating in the treatment separately for each group. This is given by</p>
<p><span class="math display">\[
  \theta_S(g) = \frac{1}{\mathcal{T} - g + 1} \sum_{t=2}^{\mathcal{T}} \mathbf{1}\{g \leq t\} ATT(g,t)
\]</span></p>
<p>This parameter may be of interest in its own right, but a natural overall effect parameter is given by</p>
<p><span class="math display">\[
  \theta^O_S := \sum_{g=2}^{\mathcal{T}} \theta_S(g) P(G=g)
\]</span></p>
<p>This is the overall effect of participating in the treatment across all groups that have ever participated in the treatment. This is close to being a multi-period analogue of the <span class="math inline">\(ATT\)</span> in the two period case.</p>
<p>Another main parameter of interest in the context of DID with multiple periods is what we call a dynamic effects estimator -- but the interpretation is what is ascribed to &quot;event study regressions&quot; that are common in applied work. This dynamic effects estimator is given by</p>
<p><span class="math display">\[
  \theta_D(e) := \sum_{g=2}^{\mathcal{T}} \mathbf{1} \{ g + e \leq \mathcal{T} \} ATT(g,g+e) P(G=g | G+e \leq \mathcal{T})
\]</span></p>
<p>This is the average effect of participating in the treatment for the group of units that have been exposed to the treatment for exactly <span class="math inline">\(e\)</span> time periods.</p>
<p>All of these aggregations are available in the <strong>did</strong> package and examples with real data are available in our <a href="did-basics.html">Getting Started with the <strong>did</strong> Package</a> vignette.</p>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>This vignette has covered basic background issues on DID with multiple periods. Callaway and Sant'Anna (2020) discusses many extensions and these are all provided in the <strong>did</strong> package as well. <a href="articles/index.html">See our User Guides for more details.</a></p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<ul>
<li><p>Callaway, Brantly, and Pedro HC Sant'Anna. &quot;Difference-in-differences with multiple time periods.&quot; Available at SSRN 3148250 (2020).</p></li>
<li><p>De Chaisemartin, Clement, and Xavier d'Haultfoeuille. &quot;Two-way fixed effects estimators with heterogeneous treatment effects.&quot; American Economic Review 110.9 (2020): 2964-96.</p></li>
<li><p>Goodman-Bacon, Andrew. Difference-in-differences with variation in treatment timing.&quot; No. w25018. National Bureau of Economic Research, 2019.</p></li>
<li><p>Sun, Liyang, and Sarah Abraham. &quot;Estimating dynamic treatment effects in event studies with heterogeneous treatment effects.&quot; Available at SSRN 3158747 (2020).</p></li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
