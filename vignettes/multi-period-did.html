<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>Background</title>

<script type="text/javascript">
window.onload = function() {
  var imgs = document.getElementsByTagName('img'), i, img;
  for (i = 0; i < imgs.length; i++) {
    img = imgs[i];
    // center an image if it is the only element of its parent
    if (img.parentElement.childElementCount === 1)
      img.parentElement.style.textAlign = 'center';
  }
};
</script>



<!-- MathJax scripts -->
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML">
</script>


<style type="text/css">
body, td {
   font-family: sans-serif;
   background-color: white;
   font-size: 13px;
}

body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 20px;
}

tt, code, pre {
   font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}

h1 {
   font-size:2.2em;
}

h2 {
   font-size:1.8em;
}

h3 {
   font-size:1.4em;
}

h4 {
   font-size:1.0em;
}

h5 {
   font-size:0.9em;
}

h6 {
   font-size:0.8em;
}

a:visited {
   color: rgb(50%, 0%, 50%);
}

pre, img {
  max-width: 100%;
}
pre {
  overflow-x: auto;
}
pre code {
   display: block; padding: 0.5em;
}

code {
  font-size: 92%;
  border: 1px solid #ccc;
}

code[class] {
  background-color: #F8F8F8;
}

table, td, th {
  border: none;
}

blockquote {
   color:#666666;
   margin:0;
   padding-left: 1em;
   border-left: 0.5em #EEE solid;
}

hr {
   height: 0px;
   border-bottom: none;
   border-top-width: thin;
   border-top-style: dotted;
   border-top-color: #999999;
}

@media print {
   * {
      background: transparent !important;
      color: black !important;
      filter:none !important;
      -ms-filter: none !important;
   }

   body {
      font-size:12pt;
      max-width:100%;
   }

   a, a:visited {
      text-decoration: underline;
   }

   hr {
      visibility: hidden;
      page-break-before: always;
   }

   pre, blockquote {
      padding-right: 1em;
      page-break-inside: avoid;
   }

   tr, img {
      page-break-inside: avoid;
   }

   img {
      max-width: 100% !important;
   }

   @page :left {
      margin: 15mm 20mm 15mm 10mm;
   }

   @page :right {
      margin: 15mm 10mm 15mm 20mm;
   }

   p, h2, h3 {
      orphans: 3; widows: 3;
   }

   h2, h3 {
      page-break-after: avoid;
   }
}
</style>



</head>

<body>
<p>Difference in differences is one of the most common approaches for trying to identifying and estimate the causal effect of participating in a treatment on some outcome.</p>

<p>The &ldquo;textbook&rdquo; version of DID involves two periods and two groups.  The <em>untreated group</em> never participates in the treatment, and the <em>treated group</em> becomes treated in the second period.</p>

<p>However, much applied work deals with cases where there are more than two time periods and different individuals can become treated at different points in time.  Regardless of the number of time periods, by far the leading approach in applied work is to try to estimate the effect of the treatment using a two way fixed effects regression.  This works great in the case with two periods, but there are a number of recent methodological papers that suggest that there may be substantial drawbacks to using two way fixed effects with multiple time periods.</p>

<p>This vignette briefly discusses the emerging literature on DID with multiple time periods &ndash; both issues with standard approaches as well as remedies for these potential problems.  The <code>did</code> package implements a number of these remedies.  A vignette for how to use the <code>did</code> package is available <a href="did-basics.html">here</a>.</p>

<h2>Background</h2>

<p>To start with, we&#39;ll consider some background material in this section.  First, we&#39;ll discuss DID with two time periods and two groups &ndash; this is the &ldquo;textbook&rdquo; case of DID.  Second, we briefly consider issues with two way fixed effects regressions when there are multiple time periods.</p>

<h3>DID with 2 Periods and 2 Groups</h3>

<p>The baseline case for DID is the one with two periods (let&#39;s call these periods \(t\) and \(t-1\)) and two groups (a treated group and an untreated group).</p>

<p><strong>Notation / Setup</strong></p>

<ul>
<li><p>For \(s \in \{t,t-1\}\), \(Y_{is}(0)\) is individual \(i\)&#39;s <em>untreated potential outcomes</em> &ndash; this is the outcome that individual \(i\) would experience in period \(s\) if they <em>did not</em> participate in the treatment</p></li>
<li><p>For \(s \in \{t,t-1\}\), \(Y_{is}(1)\) is individual \(i\)&#39;s <em>treated potential outcome</em> &ndash; this is the outcome that individual \(i\) would experience in period \(s\) if they <em>did</em> participate in the treatment.</p></li>
<li><p>Set \(D=1\) for individuals in the treated group and \(D=0\) for individuals in the untreated group</p></li>
<li><p>In the first period, no one participates in the treatment.  In the second period, individuals in the treated group become treated.  This means that observed outcomes are given by
\[
Y_{it-1} = Y_{it-1}(0) \quad \textrm{and} \quad Y_{it} = D_i Y_{it}(1) + (1-D_i) Y_{it}(0)
\]
In other words, in the first period, we observe untreated potential outcomes for everyone.  In the second period, we observe treated potential outcomes for individuals that actually participate in the treatment and untreated potential outcomes for individuals that do not participate in the treatment.</p></li>
<li><p>The main parameter of interest in most DID designs is the Average Treatment Effect on the Treated (ATT).  It is given by
\[
ATT = E[Y_t(1) - Y_t(0) | D=1]
\]
This is the difference between treated and untreated potential outcomes, on average, for individuals in the treated group.</p></li>
</ul>

<p>The main assumption in DID designs is called the parallel trends assumption:</p>

<p><strong>Parallel Trends Assumption</strong></p>

<p>\[
  E[\Delta Y_t(0) | D=1] = E[\Delta Y_t(0) | D=0]
\]</p>

<p>In words, this assumption says that the change (or &ldquo;path&rdquo;) in outcomes over time that individuals in the treated group <em>would have experienced if they had not participated in the treatment</em> is the same as the path of outcomes that individuals in the untreated group actually experienced.  The parallel trends assumption allows for the level of untreated potential outcomes to differ across groups and is consistent with, for example, fixed effects models for untreated potential outcomes where the mean of the unobserved fixed effect can be different across groups.</p>

<p>This assumption is potentially useful because the path of untreated potential outcomes for individuals in the treated group (the term on the left in the above equation) is not known, but the the researcher does observe the path of untreated potential outcomes for individuals in the untreated group.  In fact, it is straightforward to show that, under the parallel trends assumption, the \(ATT\) is identified and given by
\[
  ATT = E[\Delta Y_t | D=1] - E[\Delta Y_t | D=0]
\]</p>

<p>That is, the \(ATT\) is the difference between the mean change in outcomes over time experienced by individuals in the treated group adjusted by the mean change in outcomes over time experienced by individuals in the untreated group; the latter term, under the parallel trends assumption, is what the path of outcomes for individuals in the treated group would have been if they had not participated in the treatment.</p>

<h3>Two way fixed effects regressions</h3>

<p>Now let&#39;s move to a more general case where there are \(\mathcal{T}\) total time periods.  Denote particular time periods by \(t\) where \(t=1,\ldots,\mathcal{T}\).</p>

<p>By far the most common approach to <em>trying</em> to estimate the effect of a binary treatment in this setup is the two way fixed effects regression (TWFE).  This is a regression like
\[
Y_{it} = \theta_t + \eta_i + \alpha D_{it} + v_{it}
\]
where \(\theta_t\) is a time fixed effect, \(\eta_i\) is an individual fixed effect, \(D_{it}\) is a treatment dummy variable, \(v_{it}\) are time varying unobservables that are mean independent of everything else, and \(\alpha\) is the parameter of interest.  \(\alpha\) is often interpreted as <em>the effect</em> or the <em>average effect</em> of participating in the treatment.</p>

<p>Although this is essentially a standard approach in applied work, there are a number of recent papers that point out potentially severe drawbacks of using the TWFE estimation procedure.  Academic papers: Goodman-Bacon (2019) and de Chaisemartin and D&#39;Haultfoeuille (2019); More accessible discussion: <a href="https://andrewcbaker.netlify.com/2019/09/25/difference-in-differences-methodology/">Baker (2019)</a></p>

<p><strong>When will TWFE work?</strong></p>

<ol>
<li><p>Effects really aren&#39;t heterogeneous.  If the effect of participating in the treatment really is \(\alpha\) for all units, TWFE will work great.  That being said, in many applications, treatment effects are very likely to be heterogeneous &ndash; they can may vary across different units or exhibit dynamics or change across different time periods.  In particular applications, this is worth thinking about, but, at least in our view, we think that heterogeneous effects of participating in some treatment is the leading case.  [Actually, there is one caveat here in that you can allow for some limited forms of treatment effect heterogeneity; if the average effect of participating in the treatment is the same for all groups (defined by treatment timing) across all time periods, TWFE will work just fine.  This is still a subtle case, and one advantage of the newer approaches is that they are robust (i.e., will work just fine in either case).]</p></li>
<li><p>There are only two time periods.  This is the textbook case (2 periods, one group becomes treated in the second period, the other is never treated).  In this case, under parallel trends, \(\alpha\) is going to be numerically equal to the \(ATT\).  In other words, in this case, even though it looks like you have restricted the effect of participating in the treatment to be the same across all units, TWFE exhibits <em>robustness</em> to treatment effect heterogeneity.  Unfortunately, this robustness to treatment effect heterogeneity does not continue to hold when ther are more periods and groups become treated at different points in time.</p></li>
</ol>

<p><strong>Why is TWFE not robust to treatment effect heterogeneity?</strong></p>

<p>There are entire papers written about this.  But here is the short version:  in a TWFE regression, units whose treatment status doesn&#39;t change over time serve as the controls for units whose treatment status does change over time.  With multiple time periods and variation of treatment timing, some of these comparisons are:</p>

<ul>
<li><p>newly treated units relative to never treated units (good!)</p></li>
<li><p>newly treated units relative to not yet treated units (good!)</p></li>
<li><p>newly treated units relative to already treated units (bad!!!)</p></li>
</ul>

<p>The first of these two comparisons are good (or at least in the spirit of DID) in that they take the path of outcomes experienced by units that become treated and adjust it by the path of outcomes experienced by units that are not participating in the treatment.  The third comparison is different though: it adjusts the path of outcomes for newly treated units by the path of outcomes for already treated units.  But this is not the path of untreated potential outcomes, it includes <em>treatment effect dynamics</em>.  Thus, these dynamics appear in \(\alpha\) <em>as part of the control</em>.</p>

<p>And this issue can have potentially severe consequences.  For example, it is possible to come up with examples where the effect of participating in the treatment is positive for all units in all time periods, but the TWFE estimation procedure leads to estimating a negative effect of participating in the treatment.</p>

<p><a href="https://andrewcbaker.netlify.com/2019/09/25/difference-in-differences-methodology/">Baker (2019)</a> has a really nice (and accessible) discussion of these issues in more detail.</p>

<h2>Treatment Effects in Difference in Differences Designs with Multiple Periods</h2>

<p>In light of the potential problems with TWFE regressions in DID designs with multiple periods, are there alternative approaches that can be used in this case?</p>

<p>Yes, and it turns out that it is not all that complicated!</p>

<p>To fix ideas, let&#39;s provide some extended notation and be clear about the identifying assumptions that we are going to make.</p>

<p><strong>Notation</strong></p>

<ul>
<li><p>\(Y_{it}(0)\) is individual \(i\)&#39;s untreated potential outcome.  This is the outcome that individual \(i\) would experience in period \(t\) if they do not participate in the treatment.</p></li>
<li><p>\(Y_{it}(g)\) is individual \(i\)&#39;s potential outcome in time period \(t\) if they become treated in period \(g\).</p></li>
<li><p>\(G_i\) is the time period when individual \(i\) becomes treated (often <em>groups</em> are defined by the time period when a unit becomes treated; hence, the \(G\) notation).</p></li>
<li><p>\(C_i\) is an indicator variable for whether or not an individuals is in the untreated group (it is possible for the control group to change across different time periods, but, to keep things simple here, just consider the case where we use units that never participate in the treatment as the control group).</p></li>
<li><p>\(Y_{it}\) is individual \(i\)&#39;s observed outcome in time period \(t\).  For individuals in the untreated group, \(Y_{it} = Y_{it}(0)\) in all time periods.  For individuals in other groups, we observe \(Y_{it} = \mathbf{1}\{ G_i > t\} Y_{it}(0) + \mathbf{1}\{G_i \leq t \} \mathbf{1}\{G_i \leq t\} Y_{it}(G_i)\).  The notation here is a bit complicated, but in words, we observe untreated potential outcomes for units that have not yet participated in the treatment, and we observe treated potential outcomes for units once they start to participate in the treatment (and these can depend on <em>when</em> they became treated).</p></li>
<li><p>\(X_i\) vector of covariates</p></li>
</ul>

<h3>Main Assumptions</h3>

<p><strong>Parallel Trends Assumption</strong>
For all \(g=2,&hellip;,\mathcal{T}\), \(t=2,&hellip;,\mathcal{T}\) with \(g \leq t\),
\[
  E[\Delta Y_t(0) | G=g] = E[\Delta Y_t(0) | C=1]
\]</p>

<p>This is a natural extension of the parallel trends assumption in the two period and two group case.  It says that, in the absence of treatment, trends in untreated potential outcomes would be the same across groups.  It also assumes it only when \(g \leq t\) &ndash; these are post-treatment periods for units in group \(g\).</p>

<p><strong>Staggered Treatment Adoption Assumption</strong>
Let \(D_{it} = 1\) if an individual participates in the treatment and \(D_{it}=0\) otherwise.  Then, for \(t=1,&hellip;,\mathcal{T}-1\), \(D_{it} = 1 \implies D_{it+1} = 1\).</p>

<p>Staggered treatment adoption implies that once a unit participates in the treatment, they remain in the treatment.  This is a leading case in many applications in economics.  For example, it would be the case for policies that roll out to different locations over some period of time.  It would also be the case for many individual-level treatments that have a &ldquo;scarring&rdquo; effect.  For example, in the context of job training, most applications consider participating in the treatment <em>ever</em> as defining treatment, not participating in some job training program year after year.  This assumption is what allows us to define groups by treatment timing.  </p>

<h2>Group-Time Average Treatment Effects</h2>

<p>The above assumptions are natural extensions of the identifying assumptions in the two period and two group case to the multiple period case.  </p>

<p>Likewise, a natural way to generalize the parameter of interest (the ATT) from the two period and two group case to the multiple period case is to define <strong>group-time average treatment effects</strong>:</p>

<p>\[
  ATT(g,t) = E[Y_t(g) - Y_t(0) | G=g]
\]</p>

<p>This is the average effect of participating in the treatment for individuals in group \(g\) at time period \(t\).  Notice that when there are two time periods and two groups (the textbook case), the average treatment effect on the treated is given by \(ATT = ATT(g=2,t=2)\).</p>

<p>To give a couple more examples, suppose that a researcher has access to three time periods.  Then, \(ATT(g=2,t=3)\) is the average effect of participating in the treatment for the group of individuals that become treated in time period 2 in time period 3.  Similarly, \(ATT(g=3,t=3)\) is the average effect of participating in the treatment for the group of individuals that become treated in time period 3 in time period 3.</p>

<p><strong>Identification of Group-Time Average Treatment Effects</strong></p>

<p>Under the parallel trends assumption, it is straightforward to show that group-time average treatment effects are identified.</p>

<p>These group-time average treatment effects are the building blocks of understanding the effect of participating in a treatment in DID designs with multiple time periods.</p>

<h2>Parallel Trends Conditional on Covariates</h2>

<p>In many cases, the parallel trends assumption is substantially more plausible if it holds after conditioning on observed covariates.  In other words, if the parallel trends assumption is modified to be</p>

<p><strong>Parallel Trends Assumption</strong>
For all \(g=2,&hellip;,\mathcal{T}\), \(t=2,&hellip;,\mathcal{T}\) with \(g \leq t\),
\[
  E[\Delta Y_t(0) | X, G=g] = E[\Delta Y_t(0) | X, C=1]
\]</p>

<p>This assumption says that the path of outcomes that units in group \(g\) would have experienced if they had not participated in the treatment is the same as the path of outcomes for units in the untreated group <em>conditional on having the same covariates</em>. </p>

<p>An example of a case where this assumption is attractive is one where a researcher is interested in estimating the effect of participating in job training on earnings.  In that case, if the path of earnings (in the absence of participating in job training) depends on things like education, previous occupation, or years of experience (which it almost certainly does), then it would be important to condition on these types of variables in order to make parallel trends hold.  </p>

<p>In this case, the parameter of interest is still often the \(ATT\).  It is still straightforward to identify and estimate the \(ATT\) in this case.  Basically, one needs to estimate the change in outcomes for individuals in the untreated group conditional on \(X\), but average out \(X\) over the distribution of covariates for indivduals in group \(g\) to obtain \(ATT(g,t)\) (see Callaway and Sant&#39;Anna (2019) and references therein for many more details).  But the <strong>did</strong> package automates all of this for the user in this case.</p>

<h2>Aggregating Group-Time Average Treatment Effects</h2>

<p>Group-time average treatment effects are natural parameters to identify in the context of DID with multiple periods and multiple groups.  But in many applications, there may be a lot of them.  This are some benefits and costs here.  The main benefit is that it is relatively straightforward to think about heterogeneous effects across groups and time using group-time average treatment effects.  On the other hand, it can be hard to summarize them (e.g., they are not just a single number).</p>

<p>In our paper, we propose a number of ways to aggregate group-time average treatment effects.  Here, we will just consider a few that we think applied researchers are most likely to use.  First, consider the average effect of participating in the treatment separately for each group.  This is given by</p>

<p>\[
  \theta_S(g) = \frac{1}{\mathcal{T} - g + 1} \sum_{t=2}^{\mathcal{T}} \mathbf{1}\{g \leq t\} ATT(g,t)
\]</p>

<p>This parameter may be of interest in its own right, but a natural overall effect parameter is given by</p>

<p>\[
  \theta^O_S := \sum_{g=2}^{\mathcal{T}} \theta_S(g) P(G=g)
\]</p>

<p>This is the overall effect of participating in the treatment across all groups that have ever participated in the treatment.  This is close to being an multi-period analogue of the \(ATT\) in the two period case.  </p>

<p>Another main parameter of interest in the context of DID with multiple periods is what we call a dynamic effects estimator &ndash; but the interpretation is what is ascribed to &ldquo;event studies&#39;&#39; that are common in applied work.  This dynamic effects estimator is given by</p>

<p>\[
  \theta_D(e) := \sum_{g=2}^{\mathcal{T}} \mathbf{1} \{ g + e \leq \mathcal{T} \} ATT(g,g+e) P(G=g | G+e \leq \mathcal{T})
\]</p>

<p>This is the average effect of participating in the treatment for the group of units that have been exposed to the treatment for exactly \(e\) time periods.  </p>

<p>All of these aggregations are available in the <strong>did</strong> package and examples with real data are available in our <a href="did-basics.html">Getting Started with the <strong>did</strong> Package</a> vignette.</p>

<h2>Conclusion</h2>

<p>This vignette has covered basic background issues on DID with multiple periods.  Callaway and Sant&#39;Anna (2019) discusses many extensions and these are all provided in the <strong>did</strong> package as well. <a href="articles/index.html">See our User Guides for more details.</a></p>

</body>

</html>
